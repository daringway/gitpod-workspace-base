#!/usr/bin/env bash

ENV_PYTHON_VERSION=${1:-latest}

# These are for python, should we move them into install-python?
apt-get install -y build-essential zlib1g-dev libssl-dev libncurses5-dev libsqlite3-dev libreadline-dev libtk8.6 libgdm-dev libdb4o-cil-dev libpcap-dev

curl https://pyenv.run | bash

echo '
export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"' >> ~/.bashrc

# eval "$(pyenv virtualenv-init -)"' >> ~/.bashrc

. ~/.bashrc

# TODO, make this dynamic to use ${ENV_PYTHON_VERSION}:latest because local doesn't accept latest like install
pyenv install --skip-existing ${ENV_PYTHON_VERSION}

echo "pyenv global ${ENV_PYTHON_VERSION}" >> ~/.bashrc

echo "Searing for requirements.txt from $(pwd)"
for REQ in requirements.txt .devcontainer/requirements.txt
do
    if [[ -f $REQ ]]
    then
        pip install -r $REQ
    fi
done